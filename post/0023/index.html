<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-40P594EVM8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-40P594EVM8');
</script>
<!-- End Google Analytics -->

  
  <title>Nginx 缓存配置：原理、应用与实战指南 | ChatGIS Space</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Nginx 作为一款高性能的 Web 服务器和反向代理服务器，其缓存功能能够有效提升网站性能、降低后端服务器压力。在GIS领域，特别针对地图加载时的大量请求，缓存的配置必不可少。">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx 缓存配置：原理、应用与实战指南">
<meta property="og:url" content="https://chatgis.space/post/0023/index.html">
<meta property="og:site_name" content="ChatGIS Space">
<meta property="og:description" content="Nginx 作为一款高性能的 Web 服务器和反向代理服务器，其缓存功能能够有效提升网站性能、降低后端服务器压力。在GIS领域，特别针对地图加载时的大量请求，缓存的配置必不可少。">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-06-29T01:36:08.000Z">
<meta property="article:modified_time" content="2025-06-30T01:42:56.659Z">
<meta property="article:author" content="ChatGIS">
<meta property="article:tag" content="高德">
<meta property="article:tag" content="Nginx">
<meta property="article:tag" content="Cache">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="ChatGIS Space" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/images/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.2.0/css/fork-awesome.min.css">

<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ChatGIS Space</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">The blog, static website and contact information of ChatGIS.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
          <a class="main-nav-link" href="/gisshow">GisShow</a>
        
          <a class="main-nav-link" href="/huanyu">HuanYu</a>
        
      </nav>
      <nav id="sub-nav">
        
          
            <a class="nav-icon" target="_blank" rel="noopener" href="https://github.com/ChatGIS"><span class="fa fa-github"></span></a>
          
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://chatgis.space"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-0023" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/post/0023/index.html" class="article-date">
  <time class="dt-published" datetime="2025-06-29T01:36:08.000Z" itemprop="datePublished">2025-06-29</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%B0%83%E4%BC%98/">调优</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      Nginx 缓存配置：原理、应用与实战指南
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        
    <div id="toc">
        <strong class="sidebar-title">目录</strong>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%90%86%E8%A7%A3Nginx%E7%BC%93%E5%AD%98"><span class="toc-text">1. 理解Nginx缓存</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-Nginx-%E7%BC%93%E5%AD%98%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-text">1.1. Nginx 缓存的工作流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Nginx-%E7%BC%93%E5%AD%98%E7%9A%84%E4%BD%9C%E7%94%A8"><span class="toc-text">1.2. Nginx 缓存的作用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9F%BA%E7%A1%80%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE"><span class="toc-text">2. 基础缓存配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%88%9B%E5%BB%BA%E7%BC%93%E5%AD%98%E8%B7%AF%E5%BE%84"><span class="toc-text">2.1 创建缓存路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%90%AF%E7%94%A8%E7%BC%93%E5%AD%98"><span class="toc-text">2.2. 启用缓存</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%BC%93%E5%AD%98%E9%85%8D%E7%BD%AE%E6%8C%87%E4%BB%A4"><span class="toc-text">3. 缓存配置指令</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-proxy-cache"><span class="toc-text">3.1. proxy_cache</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-proxy-cache-path"><span class="toc-text">3.2. proxy_cache_path</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-proxy-cache-use-stale"><span class="toc-text">3.3. proxy_cache_use_stale</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-proxy-cache-background-update"><span class="toc-text">3.4. proxy_cache_background_update</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-5-proxy-cache-bypass"><span class="toc-text">3.5. proxy_cache_bypass</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-6-proxy-ignore-headers"><span class="toc-text">3.6. proxy_ignore_headers</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%BC%93%E5%AD%98%E6%B5%8B%E8%AF%95"><span class="toc-text">4. 缓存测试</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E7%BC%93%E5%AD%98%E7%8A%B6%E6%80%81"><span class="toc-text">4.1. 缓存状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-Cache-Control%E7%9A%84%E5%BD%B1%E5%93%8D"><span class="toc-text">4.2. Cache-Control的影响</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E7%BC%93%E5%AD%98%E4%BD%BF%E7%94%A8%E6%83%85%E5%86%B5"><span class="toc-text">4.3. 缓存使用情况</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-text">5. 注意事项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E9%97%AE%E9%A2%98"><span class="toc-text">5.1. 缓存一致性问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E7%BC%93%E5%AD%98%E7%A9%BA%E9%97%B4%E7%AE%A1%E7%90%86"><span class="toc-text">5.2. 缓存空间管理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7%E4%B8%8E%E8%B0%83%E4%BC%98"><span class="toc-text">5.3. 性能监控与调优</span></a></li></ol></li></ol>
    </div>

        <p>Nginx 作为一款高性能的 Web 服务器和反向代理服务器，其缓存功能能够有效提升网站性能、降低后端服务器压力。在GIS领域，特别针对地图加载时的大量请求，缓存的配置必不可少。</p>
<span id="more"></span>
<h2 id="1-理解Nginx缓存"><a href="#1-理解Nginx缓存" class="headerlink" title="1. 理解Nginx缓存"></a>1. 理解Nginx缓存</h2><p>缓存（Cache）的本质是一种<strong>临时存储机制</strong>，它将频繁访问的数据存储在靠近请求端的位置，以便在后续请求到来时，能够快速获取数据，而无需再次经过复杂的处理流程或访问后端服务器。<br>在 Nginx 中，缓存功能主要用于存储后端服务器响应的内容，无论是静态资源（如图片、CSS、JS 文件），还是动态 API 返回的数据，都可以通过缓存进行复用。</p>
<h3 id="1-1-Nginx-缓存的工作流程"><a href="#1-1-Nginx-缓存的工作流程" class="headerlink" title="1.1. Nginx 缓存的工作流程"></a>1.1. Nginx 缓存的工作流程</h3><p>Nginx 缓存的工作流程可以简单概括为 “缓存写入” 和 “缓存读取” 两个阶段：</p>
<ul>
<li><strong>缓存写入</strong>：当 Nginx 接收到客户端请求时，它会先检查请求是否命中缓存。如果未命中，Nginx 会将请求转发给后端服务器，获取响应内容。在接收到响应后，Nginx 会根据配置规则将响应内容存储到缓存中，并记录缓存键与内容的对应关系。</li>
<li><strong>缓存读取</strong>：当后续请求到达时，Nginx 会根据请求的特征生成缓存键，并在缓存中查找对应的内容。如果找到匹配的缓存键，Nginx 将直接从缓存中读取数据并返回给客户端，完成请求处理；如果未找到，则重复 “缓存写入” 的流程。</li>
</ul>
<h3 id="1-2-Nginx-缓存的作用"><a href="#1-2-Nginx-缓存的作用" class="headerlink" title="1.2. Nginx 缓存的作用"></a>1.2. Nginx 缓存的作用</h3><p>Nginx <strong>缓存的核心作用</strong>体现在以下几个方面：</p>
<ul>
<li>加速响应速度：直接从缓存中读取数据，避免了与后端服务器的交互，极大缩短了响应时间，提升用户体验；</li>
<li>降低后端压力：大量重复请求由缓存直接处理，减少了后端服务器的负载，节省计算资源和带宽成本；</li>
<li>提高系统可用性：当后端服务器出现故障或维护时，Nginx 可以继续提供缓存中的数据，保证服务的连续性，避免前端出现错误页面；</li>
</ul>
<h2 id="2-基础缓存配置"><a href="#2-基础缓存配置" class="headerlink" title="2. 基础缓存配置"></a>2. 基础缓存配置</h2><p>该章节通过简单配置实现缓存的初步使用。</p>
<h3 id="2-1-创建缓存路径"><a href="#2-1-创建缓存路径" class="headerlink" title="2.1 创建缓存路径"></a>2.1 创建缓存路径</h3><p>首先，需要在 Nginx 配置文件中定义缓存路径和缓存区域。以下是一个基础的缓存配置示例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 在 http 块中添加</span><br><span class="line">proxy_cache_path /var/cache/nginx levels=1:2 keys_zone=my_cache:10m max_size=10g inactive=60m use_temp_path=off;</span><br></pre></td></tr></table></figure>
<p><strong>参数说明</strong>：</p>
<ul>
<li><code>/var/cache/nginx</code>：缓存文件存储路径（需提前创建并确保 Nginx 有读写权限）；</li>
<li><code>levels=1:2</code>：缓存目录结构（一级目录 1 个字符，二级目录 2 个字符，如 c&#x2F;ab&#x2F;key）；</li>
<li><code>keys_zone=my_cache:10m</code>：其中，<code>my_cache</code>为自定义的缓存名称，并分配<code>10m</code>的缓存空间；</li>
<li><code>max_size=10g</code>：磁盘缓存的最大空间（超过时按 LRU 淘汰）。</li>
<li><code>inactive=60m</code>：缓存数据在未被访问时的保留时间，即如果60分钟内没有请求访问缓存的内容，则会被自动清除（7d，保留时间为7天）。</li>
<li><code>use_temp_path=off</code>：直接在缓存目录写文件，避免临时路径的额外 I&#x2F;O。</li>
</ul>
<h3 id="2-2-启用缓存"><a href="#2-2-启用缓存" class="headerlink" title="2.2. 启用缓存"></a>2.2. 启用缓存</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name your_domain.com;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_pass http://backend_server;  # 后端服务器地址</span><br><span class="line"></span><br><span class="line">        # 启用缓存</span><br><span class="line">        proxy_cache my_cache;</span><br><span class="line">        proxy_cache_key &quot;$scheme$host$request_uri&quot;;</span><br><span class="line">        proxy_cache_valid 200 304 12h;  # 对200和304状态码的响应缓存12小时</span><br><span class="line">        proxy_cache_valid any 5m;  # 其他状态码缓存5分钟</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>配置说明</strong>：</p>
<ul>
<li><code>proxy_cache</code>：指定使用的缓存区域，区域名称是由上一步中<code>keys_zone</code>创建的;</li>
<li><code>proxy_cache_key</code>：定义了缓存键的生成规则，根据请求的协议、主机名和 URI 生成唯一的缓存键；</li>
<li><code>proxy_cache_valid</code>：设置了不同 HTTP 状态码的缓存时间；</li>
</ul>
<p>通过以上配置，就可以使用Nginx缓存啦。</p>
<h2 id="3-缓存配置指令"><a href="#3-缓存配置指令" class="headerlink" title="3. 缓存配置指令"></a>3. 缓存配置指令</h2><p>本章节参考官网的说明格式，对常用配置项进行整理，官网文档：<a target="_blank" rel="noopener" href="https://nginx.org/en/docs/http/ngx_http_proxy_module.html">https://nginx.org/en/docs/http/ngx_http_proxy_module.html</a></p>
<h3 id="3-1-proxy-cache"><a href="#3-1-proxy-cache" class="headerlink" title="3.1. proxy_cache"></a>3.1. proxy_cache</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法：proxy_cache zone | off;</span><br><span class="line">默认：proxy_cache off;</span><br><span class="line">位置：http, server, location</span><br></pre></td></tr></table></figure>
<p>定义用于缓存的共享内存区域。 同一区域可以在多个地方使用。</p>
<h3 id="3-2-proxy-cache-path"><a href="#3-2-proxy-cache-path" class="headerlink" title="3.2. proxy_cache_path"></a>3.2. proxy_cache_path</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法：proxy_cache_path path [levels=levels] [use_temp_path=on|off] keys_zone=name:size [inactive=time] [max_size=size] [min_free=size] [manager_files=number] [manager_sleep=time] [manager_threshold=time] [loader_files=number] [loader_sleep=time] [loader_threshold=time] [purger=on|off] [purger_files=number] [purger_sleep=time] [purger_threshold=time];</span><br><span class="line">默认：proxy_cache_path path [levels=levels] [use_temp_path=on|off] keys_zone=name:size [inactive=time] [max_size=size] [min_free=size] [manager_files=number] [manager_sleep=time] [manager_threshold=time] [loader_files=number] [loader_sleep=time] [loader_threshold=time] [purger=on|off] [purger_files=number] [purger_sleep=time] [purger_threshold=time];</span><br><span class="line">位置：http</span><br></pre></td></tr></table></figure>
<p>设置缓存的路径和其他参数。<br>缓存数据存储在文件中，缓存中的文件名是MD5函数将<code>proxy_cache_key</code>的值加密得到的。<br>该参数定义了缓存的层次结构： 从 1 到 3，每个级别接受值 1 或 2。 例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxy_cache_path /data/nginx/cache levels=1:2 keys_zone=one:10m;</span><br></pre></td></tr></table></figure>
<p>缓存中的文件名将如下所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/data/nginx/cache/c/29/b7f54b2df7773722d382f4809d65029c</span><br></pre></td></tr></table></figure>
<p>其他参数前往官网查看。</p>
<h3 id="3-3-proxy-cache-use-stale"><a href="#3-3-proxy-cache-use-stale" class="headerlink" title="3.3. proxy_cache_use_stale"></a>3.3. proxy_cache_use_stale</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法：proxy_cache_use_stale error | timeout | invalid_header | updating | http_500 | http_502 | http_503 | http_504 | http_403 | http_404 | http_429 | off ...;</span><br><span class="line">默认：proxy_cache_use_stale off;</span><br><span class="line">位置：http, server, location</span><br></pre></td></tr></table></figure>
<p>确定在哪些情况下可以使用过时的缓存响应。</p>
<h3 id="3-4-proxy-cache-background-update"><a href="#3-4-proxy-cache-background-update" class="headerlink" title="3.4. proxy_cache_background_update"></a>3.4. proxy_cache_background_update</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">语法:	proxy_cache_background_update on | off;</span><br><span class="line">默认:	proxy_cache_background_update off;</span><br><span class="line">位置:	http, server, location</span><br><span class="line">该命令出现于version 1.11.10.</span><br></pre></td></tr></table></figure>
<p>当过期的缓存返回给客户端时，允许启动后台子请求更新过期的缓存项。请注意，在更新时必须允许使用过时的缓存响应。</p>
<h3 id="3-5-proxy-cache-bypass"><a href="#3-5-proxy-cache-bypass" class="headerlink" title="3.5. proxy_cache_bypass"></a>3.5. proxy_cache_bypass</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法:	proxy_cache_bypass string ...;</span><br><span class="line">默认:	—</span><br><span class="line">位置:	http, server, location</span><br></pre></td></tr></table></figure>
<p>定义不从缓存中获取响应的条件。 如果字符串参数的至少一个值不为空且不等于 “0”，则不会从缓存中获取响应：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">proxy_cache_bypass $cookie_nocache $arg_nocache$arg_comment;</span><br><span class="line">proxy_cache_bypass $http_pragma    $http_authorization;</span><br></pre></td></tr></table></figure>
<p>可以与<code> proxy_no_cache</code> 指令一起使用。</p>
<h3 id="3-6-proxy-ignore-headers"><a href="#3-6-proxy-ignore-headers" class="headerlink" title="3.6. proxy_ignore_headers"></a>3.6. proxy_ignore_headers</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法:	proxy_ignore_headers field ...;</span><br><span class="line">默认:	—</span><br><span class="line">Context:	http, server, location</span><br></pre></td></tr></table></figure>
<p>禁用来自代理服务器的某些响应标头字段的处理。 可以忽略以下字段：X-Accel-Redirect”, “X-Accel-Expires”, “X-Accel-Limit-Rate” (1.1.6), “X-Accel-Buffering” (1.1.6), “X-Accel-Charset” (1.1.6), “Expires”, “Cache-Control”, “Set-Cookie” (0.8.44), and “Vary” (1.7.7)。<br>如果未禁用，则这些标头字段的处理将如下所示影响：</p>
<ul>
<li>“X-Accel-Expires”, “Expires”, “Cache-Control”, “Set-Cookie”, and “Vary” 设置响应缓存的参数;</li>
<li>“X-Accel-Redirect” ：执行内部 重定向到指定的 URI;</li>
<li>“X-Accel-Limit-Rate” ：设置速率 限制向客户传输响应;</li>
<li>“X-Accel-Buffering” ：启用或禁用响应的缓冲;</li>
<li>“X-Accel-Charset”： 设置响应的所需字符集。</li>
</ul>
<h2 id="4-缓存测试"><a href="#4-缓存测试" class="headerlink" title="4. 缓存测试"></a>4. 缓存测试</h2><p>当前在配置文件中新增了一个关于高德地图相关的链接。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">location /webapi.amap.com/ &#123;</span><br><span class="line">    proxy_set_header Accept-Encoding &quot;&quot;;</span><br><span class="line">    proxy_pass   http://webapi.amap.com/;</span><br><span class="line">    # 缓存设置</span><br><span class="line">    proxy_cache amap_cache;</span><br><span class="line">    proxy_cache_key &quot;$scheme$host$request_uri$args&quot;;</span><br><span class="line">    proxy_cache_valid 200 304 10s;</span><br><span class="line">    proxy_cache_valid any 10m;</span><br><span class="line">    proxy_cache_use_stale error timeout invalid_header updating http_500 http_502 http_503 http_504;</span><br><span class="line">    proxy_cache_background_update on;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-1-缓存状态"><a href="#4-1-缓存状态" class="headerlink" title="4.1. 缓存状态"></a>4.1. 缓存状态</h3><p>新增以下配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add_header Nginx-Cache $upstream_cache_status;</span><br></pre></td></tr></table></figure>
<p><code>$upstream_cache_status</code>包含以下几种状态:</p>
<ul>
<li>MISS：未命中，请求被传送到后端；</li>
<li>HIT：缓存命中；</li>
<li>EXPIRED： 缓存已经过期请求被传送到后端；</li>
<li>UPDATING：正在更新缓存，将使用旧的应答；</li>
<li>STALE：后端将得到过期的应答；</li>
</ul>
<p>增加该配置后，可以在请求后查看响应头里面多了一个参数<code>nginx-cache </code>，这样就可以根据这个值判断是否使用了缓存。</p>
<h3 id="4-2-Cache-Control的影响"><a href="#4-2-Cache-Control的影响" class="headerlink" title="4.2. Cache-Control的影响"></a>4.2. Cache-Control的影响</h3><p>多次请求中 Nginx 缓存状态始终为 “MISS”，经排查发现源站响应头包含Cache-Control: max-age&#x3D;0。该 HTTP 缓存控制字段会强制客户端（浏览器 &#x2F; 代理）跳过缓存直接回源请求。<br>为了使用Nginx缓存，可以使用以下配置消除它的影响</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxy_ignore_headers Cache-Control;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-缓存使用情况"><a href="#4-3-缓存使用情况" class="headerlink" title="4.3. 缓存使用情况"></a>4.3. 缓存使用情况</h3><p>为了方便测试，首先将过期时间调整为10秒：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">proxy_cache_valid 200 304 10s;</span><br></pre></td></tr></table></figure>

<p>第一次访问，Nginx-Cache&#x3D;MISS，说明此时还没有缓存；<br>第二次访问，Nginx-Cache&#x3D;HIT，此时命中缓存；<br>第三次访问，Nginx-Cache&#x3D;STALE，此时缓存过期；<br>第四次访问，Nginx-Cache&#x3D;HIT，重新命中缓存；</p>
<h2 id="5-注意事项"><a href="#5-注意事项" class="headerlink" title="5. 注意事项"></a>5. 注意事项</h2><h3 id="5-1-缓存一致性问题"><a href="#5-1-缓存一致性问题" class="headerlink" title="5.1. 缓存一致性问题"></a>5.1. 缓存一致性问题</h3><p>缓存的使用可能导致数据不一致，尤其是对于动态更新的数据。为了避免这个问题：</p>
<ul>
<li>可以设置较短的缓存时间；</li>
<li>数据更新后及时清除相关缓存；</li>
<li>通过Etag和Last-Modified头实现缓存的验证机制，确保客户端获取到最新的数据；</li>
</ul>
<h3 id="5-2-缓存空间管理"><a href="#5-2-缓存空间管理" class="headerlink" title="5.2. 缓存空间管理"></a>5.2. 缓存空间管理</h3><p>合理设置缓存空间大小和过期时间至关重要：</p>
<ul>
<li>过大的缓存空间可能导致磁盘占用过高；</li>
<li>过小的空间则可能频繁触发缓存淘汰机制；</li>
<li>建议根据实际业务需求和服务器资源情况，动态调整缓存空间和过期策略；</li>
</ul>
<h3 id="5-3-性能监控与调优"><a href="#5-3-性能监控与调优" class="headerlink" title="5.3. 性能监控与调优"></a>5.3. 性能监控与调优</h3><p>定期监控 Nginx 缓存的命中率、响应时间等指标，分析缓存对系统性能的影响。<br>根据监控结果，优化缓存配置，如调整缓存键规则、缓存时间等，以达到最佳性能效果。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://chatgis.space/post/0023/index.html" data-id="cmbhyq488001be4v71t0od5f2" data-title="Nginx 缓存配置：原理、应用与实战指南" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Cache/" rel="tag">Cache</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%AB%98%E5%BE%B7/" rel="tag">高德</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/post/0022/index.html" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Vue2 与 Vue3 父子组件传值及方法调用</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/GIS/">GIS</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B0%83%E4%BC%98/">调优</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cache/" rel="tag">Cache</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GeoServer/" rel="tag">GeoServer</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GitHub/" rel="tag">GitHub</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/" rel="tag">Linux</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Nginx/" rel="tag">Nginx</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenSource/" rel="tag">OpenSource</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Redis/" rel="tag">Redis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSG/" rel="tag">SSG</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Tomcat/" rel="tag">Tomcat</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Vue/" rel="tag">Vue</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/low-code/" rel="tag">low-code</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" rel="tag">代码规范</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BD%8E%E7%A9%BA%E7%BB%8F%E6%B5%8E/" rel="tag">低空经济</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%9C%B0%E7%90%86%E7%9F%A5%E8%AF%86/" rel="tag">地理知识</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%93%A6%E7%89%87/" rel="tag">瓦片</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%AB%98%E5%BE%B7/" rel="tag">高德</a><span class="tag-list-count">2</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Cache/" style="font-size: 10px;">Cache</a> <a href="/tags/GeoServer/" style="font-size: 10px;">GeoServer</a> <a href="/tags/GitHub/" style="font-size: 15px;">GitHub</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/Nginx/" style="font-size: 15px;">Nginx</a> <a href="/tags/OpenSource/" style="font-size: 10px;">OpenSource</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/SSG/" style="font-size: 20px;">SSG</a> <a href="/tags/Tomcat/" style="font-size: 10px;">Tomcat</a> <a href="/tags/Vue/" style="font-size: 10px;">Vue</a> <a href="/tags/low-code/" style="font-size: 10px;">low-code</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 10px;">代码规范</a> <a href="/tags/%E4%BD%8E%E7%A9%BA%E7%BB%8F%E6%B5%8E/" style="font-size: 10px;">低空经济</a> <a href="/tags/%E5%9C%B0%E7%90%86%E7%9F%A5%E8%AF%86/" style="font-size: 10px;">地理知识</a> <a href="/tags/%E7%93%A6%E7%89%87/" style="font-size: 10px;">瓦片</a> <a href="/tags/%E9%AB%98%E5%BE%B7/" style="font-size: 15px;">高德</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2025/">2025</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/">2024</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/post/0023/index.html">Nginx 缓存配置：原理、应用与实战指南</a>
          </li>
        
          <li>
            <a href="/post/0022/index.html">Vue2 与 Vue3 父子组件传值及方法调用</a>
          </li>
        
          <li>
            <a href="/post/0021/index.html">地球半径、周长与米单位的前世今生</a>
          </li>
        
          <li>
            <a href="/post/0020/index.html">Linux环境通过Tomcat部署GeoServer过程详细记录</a>
          </li>
        
          <li>
            <a href="/post/0019/index.html">Linux 服务器离线搭建 Nginx：详细图文教程与避坑指南</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2025 ChatGIS<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
    <a href="/gisshow" class="mobile-nav-link">GisShow</a>
  
    <a href="/huanyu" class="mobile-nav-link">HuanYu</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>